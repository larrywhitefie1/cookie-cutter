parameters:
  versionSpec: ''

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: ${{ parameters.versionSpec }}
    displayName: Install Node.js
  - script: |
      curl -o- -L https://yarnpkg.com/install.sh | bash
    displayName: Install Yarn
  - task: CacheBeta@0
    inputs:
      key: |
        yarn
        $(Agent.OS)
        $(Build.SourcesDirectory)/yarn.lock
      path: $(Pipeline.Workspace)/.yarn
    displayName: Cache Yarn Packages
  - script: yarn --cache-folder="$(Pipeline.Workspace)/.yarn" --frozen-lockfile
    displayName: Install Dependencies
  - script: yarn run --cwd=packages/core build # this always needs to build first
    displayName: Build Core
